{% extends "base.html" %}

{% block extra_style %}
.question-card { margin-bottom: 20px; }
.question-card h3 { font-size: 16px; color: #333; margin-bottom: 14px; line-height: 1.5; }
.options { display: flex; gap: 12px; }
.option-btn {
    flex: 1;
    padding: 12px 0;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    background: white;
    cursor: pointer;
    font-size: 15px;
    font-weight: 600;
    transition: all 0.2s;
    color: #555;
}
.option-btn:hover { border-color: #1a237e; color: #1a237e; }
.option-btn.selected-yes { background: #e8f5e9; border-color: #4caf50; color: #2e7d32; }
.option-btn.selected-no  { background: #fce4ec; border-color: #e91e63; color: #c2185b; }
.submit-btn {
    width: 100%;
    padding: 14px;
    background: #1a237e;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 8px;
    transition: background 0.2s;
}
.submit-btn:hover { background: #283593; }
.submit-btn:disabled { background: #bbb; cursor: not-allowed; }
.already-voted {
    text-align: center;
    padding: 20px;
    color: #888;
    font-size: 15px;
}
.already-voted a {
    color: #1a237e;
    text-decoration: none;
    font-weight: 600;
}
.q-number {
    display: inline-block;
    background: #e8eaf6;
    color: #1a237e;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    line-height: 28px;
    text-align: center;
    font-size: 13px;
    font-weight: 700;
    margin-right: 8px;
}
{% endblock %}

{% block content %}
{% if voted %}
<div class="card already-voted">
    <p>You have already submitted your vote in this session.</p>
    <br>
    <a href="{{ url_for('results') }}">View Results &rarr;</a>
    <br><br>
    <form method="POST" action="{{ url_for('reset') }}">
        <button type="submit" style="background:none;border:none;color:#aaa;font-size:12px;cursor:pointer;">Reset my session</button>
    </form>
</div>
{% else %}
<form method="POST" action="{{ url_for('vote') }}" id="pollForm">
    {% for qid, question in questions.items() %}
    <div class="card question-card">
        <h3>
            <span class="q-number">{{ loop.index }}</span>
            {{ question }}
        </h3>
        <div class="options">
            <button type="button" class="option-btn" onclick="selectAnswer('{{ qid }}', 'yes', this)">
                Yes
            </button>
            <button type="button" class="option-btn" onclick="selectAnswer('{{ qid }}', 'no', this)">
                No
            </button>
            <input type="hidden" name="{{ qid }}" id="{{ qid }}-value" value="">
        </div>
    </div>
    {% endfor %}

    <div class="card" style="padding: 20px 32px;">
        <button type="submit" class="submit-btn" id="submitBtn" disabled>
            Answer all questions to submit
        </button>
    </div>
</form>
{% endif %}

<script>
    const answered = {};
    const total = {{ questions | length }};

    function selectAnswer(qid, answer, btn) {
        const siblings = btn.parentElement.querySelectorAll('.option-btn');
        siblings.forEach(b => { b.classList.remove('selected-yes', 'selected-no'); });
        btn.classList.add(answer === 'yes' ? 'selected-yes' : 'selected-no');
        document.getElementById(qid + '-value').value = answer;
        answered[qid] = true;
        if (Object.keys(answered).length === total) {
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit My Vote';
        }
    }
</script>
{% endblock %}
